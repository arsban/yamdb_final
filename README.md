# yamdb_final
![example workflow](https://github.com/arsban/yamdb_final/actions/workflows/yamdb_workflow.yml/badge.svg)

# YaMDb
## Описание
**Небольшая** социальная сеть с отзывами на произведения исскуства релизующая принципы **RestAPI**.
**Проект _не хранит произведения_, здесь нельзя посмотреть фильм или послушать музыку.**

Произведения делятся на категории:
- Книги
- Фильмы
- Музыка
- ...

Каждому произведению можно присвоить неограниченное количество жанров из списка:
- Сказка
- Рок
- Артхаус
- ...

Списки категорий и жанров в дальнейшем могут быть расширены **администраторами**.

Благодарные или возмущённые читатели оставляют к произведениям текстовые отзывы (Review) и выставляют произведению рейтинг (оценку в диапазоне от одного до десяти). Из множества оценок автоматически высчитывается средняя оценка произведения.

## Пользовательские роли:
- Аноним - может просматривать описания произведений, читать отзывы и комментарии.
- Аутентифицированный пользователь — может читать всё, как и Аноним, дополнительно может публиковать отзывы и ставить рейтинг произведениям (фильмам/книгам/песням), может комментировать чужие отзывы и ставить им оценки; может редактировать и удалять свои отзывы и комментарии.
- Модератор — те же права, что и у Аутентифицированного пользователя плюс право удалять любые отзывы и комментарии.
- Администратор — полные права на управление проектом и всем его содержимым. Может создавать и удалять произведения, категории и жанры. Может назначать роли пользователям.

## Как запустить проект:
Клонировать репозиторий и перейти в него в командной строке:
```
git clone https://github.com/arsban/api_yamdb.git
```
```
cd api_yamdb
```
Cоздать и активировать виртуальное окружение:
```
python3 -m venv env
```
```
source env/bin/activate
```
Установить зависимости из файла requirements.txt:
```
python3 -m pip install --upgrade pip
```
```
pip install -r requirements.txt
```
Выполнить миграции:
```
python3 manage.py migrate
```
Запустить проект:
```
python3 manage.py runserver
```

## Алгоритм регистрации пользователей
1. Пользователь отправляет POST-запрос с параметрами email и username на ```/api/v1/auth/signup/```
2. YaMDB отправляет письмо с кодом подтверждения на адрес email.
3. Пользователь отправляет POST-запрос с параметрами email и confirmation_code на ```/api/v1/auth/token/```, в ответе на запрос ему приходит token (JWT-токен).

Эти операции выполняются **один раз**, при регистрации пользователя. В результате пользователь получает токен и может работать с API, **отправляя этот токен с каждым запросом**.
После регистрации и получения токена пользователь может отправить PATCH-запрос на ```/api/v1/users/me/``` и заполнить поля в своём профайле (описание полей — в документации).
Если пользователя создаёт администратор (например, через POST-запрос ```api/v1/users/{username}```) — **письмо с кодом отправлять не нужно**.

## Примеры запросов к API
Все методы API задокументированны с помощью **ReDoc**.
Документацию можно посмотреть по адресу:
> redoc/

## Технические требования
Все необходимые пакеты перечислены в **requirements.txt**

- в директории infra создайте файл .env

## Шаблон наполнения env-файла

```bash
DB_ENGINE=django.db.backends.postgresql # указываем, что работаем с postgresql
DB_NAME=postgres # имя базы данных
POSTGRES_USER=postgres # логин для подключения к базе данных
POSTGRES_PASSWORD=postgres # пароль для подключения к БД (установите свой)
DB_HOST=db # название сервиса (контейнера)
DB_PORT=5432 # порт для подключения к БД
```


## Описание команд для запуска приложения в контейнерах

```
docker-compose up -d --build 
```

```
docker-compose exec web python manage.py migrate
```

```
docker-compose exec web python manage.py createsuperuser
```

```
docker-compose exec web python manage.py collectstatic --no-input 
```
проект доступен по ссылке http://51.250.98.104/admin/
а так же документация по ссылке http://51.250.98.104/redoc/

###### Над проектом работали:
- **Подпорин Георгий** - https://vk.com/akakiy.druz
- **Есин Никита** - https://vk.com/kazuru
- **Кириченко Денис** - https://vk.com/id2470525
